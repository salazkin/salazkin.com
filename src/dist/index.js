(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function s(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(e){if(e.ep)return;e.ep=!0;const r=s(e);fetch(e.href,r)}})();class w{constructor(){this.containerDivParams={x:0,y:0,visible:!0,alpha:1,scale:1,rotation:0},this.rootDiv=document.createElement("div"),this.rootDiv.style.position="absolute"}addChild(t){this.rootDiv.appendChild(t.getRootDiv())}getRootDiv(){return this.rootDiv}set x(t){this.containerDivParams.x=t,this.updateStyle()}get x(){return this.containerDivParams.x}set y(t){this.containerDivParams.y=t,this.updateStyle()}get y(){return this.containerDivParams.y}set scale(t){this.containerDivParams.scale=t,this.updateStyle()}get scale(){return this.containerDivParams.scale}set rotation(t){this.containerDivParams.rotation=t,this.updateStyle()}set alpha(t){this.containerDivParams.alpha=t,this.updateStyle()}get alpha(){return this.containerDivParams.alpha}set visible(t){this.containerDivParams.visible=t,this.updateStyle()}get visible(){return this.containerDivParams.visible}updateStyle(){this.rootDiv.style.left=`${this.containerDivParams.x}px`,this.rootDiv.style.top=`${this.containerDivParams.y}px`,this.rootDiv.style.visibility=this.containerDivParams.visible?"visible":"hidden",this.rootDiv.style.opacity=this.containerDivParams.alpha.toString(),this.rootDiv.style.transform=`scale(${this.containerDivParams.scale}) rotate(${this.containerDivParams.rotation}deg)`}}class S{constructor(){this.slots=new Map,this.once=new Map}add(t,s){this.addSlot(this.slots,t,s||this)}addOnce(t,s){this.addSlot(this.once,t,s||this)}addSlot(t,s,i=this){var e;t.has(i)||t.set(i,new Set),(e=t.get(i))==null||e.add(s)}remove(t,s){this.removeSlot(this.slots,t,s||this),this.removeSlot(this.once,t,s||this)}removeSlot(t,s,i=this){const e=t.get(i);e&&(e.delete(s),e.size===0&&t.delete(i))}removeAll(){this.slots.clear(),this.once.clear()}dispatch(t){this.slots.forEach((s,i)=>{s.forEach(e=>{e.call(i,t)})}),this.once.forEach((s,i)=>{s.forEach(e=>{e.call(i,t)})}),this.once.clear()}isEmpty(){return this.slots.size===0&&this.once.size===0}}const f=n=>n*Math.PI/180,X=n=>n*180/Math.PI,F=(n,t,s)=>n+(t-n)*s,Y=(n,t,s)=>[F(n[0],t[0],s),F(n[1],t[1],s)],k=(n,t=1)=>`rgba(${n>>16&255}, ${n>>8&255}, ${n&255}, ${t})`,I=(n,t)=>[n[0]+t[0],n[1]+t[1]],T=(n,t)=>[n[0]*t,n[1]*t],$=n=>[-n[1],n[0]];function q(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function L(n){const t=q(n);if(t===0)throw new Error("Cannot compute the unit vector of a zero vector.");return[n[0]/t,n[1]/t]}const z=(n,t,s,i)=>[b(n[0],t[0],s,i),b(n[1],t[1],s,i)],b=(n,t,s,i)=>t+(n-t)*Math.exp(-s*i),Q=(n,t,s)=>{const i=Math.cos(s),e=Math.sin(s),r=n[0]-t[0],a=n[1]-t[1];return[r*i-a*e+t[0],r*e+a*i+t[1]]},M=(n,t)=>{const s=t[0]-n[0],i=t[1]-n[1];return Math.sqrt(s*s+i*i)},O=(n,t)=>{const s=t[0]-n[0],i=t[1]-n[1];return Math.atan2(s,i)};class V{constructor(){this.rush=!1,this.currentPos=[0,0],this.fishBoundsRadius=120,this.turnDirection=0,this.onTurnDirectionChangeSignal=new S,this.setRandomSpeed(),this.setCurrentRotation(f(Math.random()*360)),this.setCurrentPosition(-120-Math.random()*120,-120-Math.random()*120)}setCurrentPosition(t,s){this.currentPos[0]=t,this.currentPos[1]=s}setCurrentRotation(t){this.currentRotation=t,this.currentMoveDirection=L([Math.cos(this.currentRotation),Math.sin(this.currentRotation)])}getCurrentRotation(){return this.currentRotation}setTurnDirection(t){this.turnDirection!==t&&(this.turnDirection=t,this.onTurnDirectionChangeSignal.dispatch(this.turnDirection))}getTurnDirection(){return this.turnDirection}getCurrentMoveDirection(){return[...this.currentMoveDirection]}getCurrentPosition(){return[...this.currentPos]}getRandomRotationAngle(){const t=Math.random()*90+30;let s=Math.random()*190;Math.random()>.3&&(s*=.6);const i=$(this.currentMoveDirection),e=Math.floor(Math.random()*2)*2-1;return i[0]*=e,i[1]*=e,{center:I(this.currentPos,T(i,t)),angle:s*e,radius:t}}getRandomForwardPoint(){const t=this.rush?1.6+Math.random()*1.6:1,s=(Math.random()*150+150)*t;return I(this.currentPos,T(this.currentMoveDirection,s))}getRandomPointOnScreen(){const t=window.innerWidth,s=window.innerHeight;return[Math.random()*t,Math.random()*s]}getClosestRandomPointOnScreen(){let t=this.getRandomPointOnScreen(),s=M(this.currentPos,t);for(let i=0;i<5;i++){const e=this.getRandomPointOnScreen(),r=M(this.currentPos,e);r<s&&(t=[...e],s=r)}return t}setRandomSpeed(){const t=this.rush?3.2+Math.random()*1.6:1;this.currentSpeed=(300+Math.random()*300)*t}setRush(t){this.rush=t}setRandomRush(){this.rush=Math.random()<.2}isRush(){return this.rush}getMoveDuration(t){return t/this.currentSpeed*1e3}isFishOutsideScreenBounds(){const t=window.innerWidth,s=window.innerHeight,[i,e]=this.currentPos;return i+this.fishBoundsRadius<0||i-this.fishBoundsRadius>t||e+this.fishBoundsRadius<0||e-this.fishBoundsRadius>s}getRandomIdleDelay(){return Math.random()*2e3+100}}class U{constructor(){this.symbols={},this.fishStateChangeSignal=new S,this.currentFishState=null}setFishState(t){this.symbols[t]===void 0&&(this.symbols[t]=Symbol(t)),this.currentFishState=this.symbols[t],this.fishStateChangeSignal.dispatch(t)}inAState(...t){for(let s=0;s<t.length;s++){const i=t[s];if(this.symbols[i]===void 0&&(this.symbols[i]=Symbol(i)),this.currentFishState===this.symbols[i])return!0}return!1}}const g=new class{constructor(){this.models=[]}initFish(n){this.models[n]={},this.models[n].fishStateModel=new U,this.models[n].fishNavigationModel=new V}getModel(n){return this.models[n]}},l=class l{constructor(t,s,i=P.Linear){this.resolve=null,this.isReverse=!1,this.duration=t,this.ease=i,this.onUpdate=s}static add(t){this.tweens.size===0&&(this.requestAnimationFrameId=requestAnimationFrame(this.onEnterFrame)),this.tweens.add(t)}static remove(t){this.tweens.delete(t),this.tweens.size===0&&cancelAnimationFrame(this.requestAnimationFrameId)}static now(){return performance.now()}params(t){return l.remove(this),Object.assign(this,t),this}start(){return this.isReverse=!1,new Promise((t,s)=>{this.resolve=t,this.startTime=l.now(),l.add(this)})}reverse(){return this.isReverse=!0,new Promise((t,s)=>{this.resolve=t,this.startTime=l.now(),l.add(this)})}tick(t){let s=(t-this.startTime)/this.duration;if(s>1&&(s=1),this.onUpdate){const i=this.ease(this.isReverse?1-s:s);this.onUpdate(i)}s>=1&&this.stop()}endInstantly(){this.onUpdate(this.isReverse?0:1),this.stop()}stop(){l.remove(this),this.resolve&&(this.resolve(this),this.resolve=null)}kill(){l.remove(this),this.onUpdate=null,this.ease=null,this.resolve=null}};l.tweens=new Set,l.onEnterFrame=()=>{const t=l.now();l.tweens.forEach(s=>{s.tick(t)}),l.requestAnimationFrameId=requestAnimationFrame(l.onEnterFrame)};let y=l;const D=class D{static getTween(t,s,i=P.Linear){let e;return this.pool.length?(e=this.pool.pop(),e.params({duration:t,onUpdate:s,ease:i})):e=new y(t,s,i),e}static returnTween(t){t.kill(),this.pool.unshift(t)}};D.pool=[];let m=D;const o=class o{};o.Linear=t=>t,o.QuadEaseIn=t=>t*t,o.QuadEaseOut=t=>t*(2-t),o.QuadEaseInOut=t=>(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1),o.CubicEaseIn=t=>t*t*t,o.CubicEaseOut=t=>--t*t*t+1,o.CubicEaseInOut=t=>(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2),o.QuarticEaseIn=t=>t*t*t*t,o.QuarticEaseOut=t=>1- --t*t*t*t,o.QuarticEaseInOut=t=>(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),o.QuinticEaseIn=t=>t*t*t*t*t,o.QuinticEaseOut=t=>--t*t*t*t*t+1,o.QuinticEaseInOut=t=>(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),o.SinEaseIn=t=>1-Math.cos(t*Math.PI/2),o.SinEaseOut=t=>Math.sin(t*Math.PI/2),o.SinEaseInOut=t=>.5*(1-Math.cos(Math.PI*t)),o.CircEaseIn=t=>1-Math.sqrt(1-t*t),o.CircEaseOut=t=>Math.sqrt(1- --t*t),o.CircEaseInOut=t=>(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),o.ElasticEaseIn=t=>t===0?0:t===1?1:-Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI),o.ElasticEaseOut=t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t-.1)*5*Math.PI)+1,o.ElasticEaseInOut=t=>t===0?0:t===1?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin((t-1.1)*5*Math.PI)+1),o.BackEaseIn=t=>t*t*((1.70158+1)*t-1.70158),o.BackEaseOut=t=>--t*t*((1.70158+1)*t+1.70158)+1,o.BackEaseInOut=t=>{const s=2.5949095;return(t*=2)<1?.5*(t*t*((s+1)*t-s)):.5*((t-=2)*t*((s+1)*t+s)+2)},o.BounceEaseIn=t=>1-o.BounceEaseOut(1-t),o.BounceEaseOut=t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,o.BounceEaseInOut=t=>t<.5?o.BounceEaseIn(t*2)*.5:o.BounceEaseOut(t*2-1)*.5+.5;let P=o;const h=new class{constructor(){this.totalSpineBones=5,this.tailSwingMaxBend=6,this.tailSwingFollowOffset=50,this.tailSpeedDecay=2,this.spineBlendDecay=5,this.spineTurnPoseBonesAngle=13,this.fishWidth=40,this.fishHeight=120,this.totalFishCount=10,this.totalColorfulFishCount=3,this.fishColors=[10092288,52479,16737792,16750899,16751052,16711680],this.defaultFishColor=11184810,this.takenFishColors=[]}getSpineBoneScale(n){return P.QuadEaseOut(n/this.totalSpineBones)}getRandomTailSpeed(n){const t=1+Math.random()*.3;return{startSpeed:(n?20:10)*t,endSpeed:2*t}}getMoveDecay(){return 1+Math.random()*2}getFishColor(n){if(n<this.totalColorfulFishCount){if(this.takenFishColors[n]===void 0){const t=Math.floor(Math.random()*this.fishColors.length);this.takenFishColors[n]=this.fishColors.splice(t,1)[0]}return this.takenFishColors[n]}return this.defaultFishColor}};class W{constructor(){this.currentState=null,this.idsArr={},this.statesArr={},this.stateChangeSignal=new S}addState(t,s){if(this.idsArr[s])throw new Error(`State already defined: ${s}`);this.idsArr[s]=Object.keys(this.idsArr).length,this.statesArr[s]=new t(this,s)}setState(t){this.currentState&&this.currentState.cleanUp(),this.currentState=this.statesArr[t],this.stateChangeSignal.dispatch(this.currentState.id),this.currentState.execute()}}const A=class A{static publish(t,s){var i;(i=this.signals[t])==null||i.dispatch(s)}static subscribe(t,s,i){let e=this.signals[t];return e||(e=new S,this.signals[t]=e),e.add(s,i),{unsubscribe:()=>{e==null||e.remove(s,i),this.cleanupSignal(t)}}}static subscribeOnce(t,s,i){let e=this.signals[t];return e||(e=new S,this.signals[t]=e),e.addOnce(s,i),{unsubscribe:()=>{e==null||e.remove(s,i),this.cleanupSignal(t)}}}static cleanupSignal(t){const s=this.signals[t];s&&s.isEmpty()&&delete this.signals[t]}};A.signals={};let d=A;class R{constructor(t,s){this.stateMachine=t,this.id=s}execute(){}cleanUp(){}}class H extends R{execute(){const{fishNavigationModel:t}=g.getModel(this.stateMachine.getFishId());t.setTurnDirection(0),this.idleTimeout=setTimeout(()=>{t.setRandomRush(),t.setRandomSpeed(),this.stateMachine.setState("rotationState")},t.getRandomIdleDelay()),this.onFishPokeSubscribe=d.subscribe("onFishPoke",s=>{s===this.stateMachine.getFishId()&&(clearTimeout(this.idleTimeout),t.setRush(!0),t.setRandomSpeed(),this.stateMachine.setState("rotationState"))})}cleanUp(){this.onFishPokeSubscribe.unsubscribe()}}class G extends R{execute(){const{fishNavigationModel:t}=g.getModel(this.stateMachine.getFishId());t.setTurnDirection(0);const s=t.getCurrentPosition();let i,e=!1;if(t.isFishOutsideScreenBounds()){i=t.getClosestRandomPointOnScreen();const u=Math.PI*.5-O(s,i);t.setCurrentRotation(u)}else i=t.getRandomForwardPoint();const r=M(s,i),a=t.getMoveDuration(r),c=m.getTween(a,u=>{const p=Y(s,i,u);t.setCurrentPosition(...p)});c.start().then(()=>{m.returnTween(c),this.stateMachine.setState(e?"rotationState":"idleState")}),this.onFishPokeSubscribe=d.subscribe("onFishPoke",u=>{u===this.stateMachine.getFishId()&&!t.isRush()&&(e=!0,t.setRush(!0),t.setRandomSpeed(),c.stop())})}cleanUp(){this.onFishPokeSubscribe.unsubscribe()}}class j extends R{execute(){const{fishNavigationModel:t}=g.getModel(this.stateMachine.getFishId());if(t.isFishOutsideScreenBounds()){this.stateMachine.setState("moveForwardState");return}const{center:s,angle:i,radius:e}=t.getRandomRotationAngle();t.setTurnDirection(i<0?-1:1);const r=t.getCurrentPosition(),a=t.getCurrentRotation(),c=Math.abs(e*f(i)),u=t.getMoveDuration(c),p=m.getTween(u,v=>{const x=f(v*i),N=Q(r,s,x);t.setCurrentPosition(...N),t.setCurrentRotation(a+x)});p.start().then(()=>{m.returnTween(p),this.stateMachine.setState("moveForwardState")}),this.onFishPokeSubscribe=d.subscribe("onFishPoke",v=>{v===this.stateMachine.getFishId()&&!t.isRush()&&(t.setRush(!0),t.setRandomSpeed(),p.stop())})}cleanUp(){this.onFishPokeSubscribe.unsubscribe()}}class K extends W{constructor(t){super(),this.fishId=t,this.addState(H,"idleState"),this.addState(j,"rotationState"),this.addState(G,"moveForwardState");const{fishStateModel:s}=g.getModel(t);this.stateChangeSignal.add(i=>{s.setFishState(i)})}getFishId(){return this.fishId}}class E extends w{constructor(){super(),this.svgNS="http://www.w3.org/2000/svg",this.currentFill=null,this.currentStroke=null,this.currentPath=null,this.currentPathStr="",this.svg=document.createElementNS(this.svgNS,"svg"),this.svg.style.position="absolute",this.rootDiv.appendChild(this.svg),this.resetBounds()}resetBounds(){this.bounds={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},this.currentPathBounds={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}beginFill(t,s=1){return this.currentFill=k(t,s),this}lineStyle(t,s,i=1){return this.currentStroke={width:t,color:k(s,i)},this}drawRect(t,s,i,e,r){var u;const a=document.createElementNS(this.svgNS,"rect");a.setAttribute("x",t.toString()),a.setAttribute("y",s.toString()),a.setAttribute("width",i.toString()),a.setAttribute("height",e.toString()),r&&(a.setAttribute("rx",r.toString()),a.setAttribute("ry",r.toString())),a.setAttribute("fill",this.currentFill??"none");const c=((u=this.currentStroke)==null?void 0:u.width)??0;return this.currentStroke&&(a.setAttribute("stroke",this.currentStroke.color),a.setAttribute("stroke-width",c.toString())),this.svg.appendChild(a),this.updateBounds(t-c*.5,s-c*.5,i+c,e+c),this}drawCircle(t,s,i){var a;const e=document.createElementNS(this.svgNS,"circle");e.setAttribute("cx",t.toString()),e.setAttribute("cy",s.toString()),e.setAttribute("r",i.toString()),e.setAttribute("fill",this.currentFill??"none");const r=((a=this.currentStroke)==null?void 0:a.width)??0;return this.currentStroke&&(e.setAttribute("stroke",this.currentStroke.color),e.setAttribute("stroke-width",r.toString())),this.svg.appendChild(e),this.updateBounds(t-i-r*.5,s-i-r*.5,i*2+r,i*2+r),this}drawPathFromString(t){const s=document.createElementNS(this.svgNS,"path");return s.setAttribute("d",t),s.setAttribute("fill",this.currentFill??"none"),this.currentStroke&&(s.setAttribute("stroke",this.currentStroke.color),s.setAttribute("stroke-width",this.currentStroke.width.toString())),this.svg.appendChild(s),this}moveTo(t,s){return this.currentPath=document.createElementNS(this.svgNS,"path"),this.currentPathStr=`M ${t} ${s}`,this.updateCurrentPathBounds(t,s),this}lineTo(t,s){var e;if(!this.currentPath)return console.error("No path has been started. Call moveTo() before calling lineTo()."),this;this.currentPathStr+=` L ${t} ${s}`,this.currentPath.setAttribute("d",this.currentPathStr),this.currentPath.setAttribute("fill",this.currentFill??"none");const i=((e=this.currentStroke)==null?void 0:e.width)??0;return this.currentStroke&&(this.currentPath.setAttribute("stroke",this.currentStroke.color),this.currentPath.setAttribute("stroke-width",i.toString())),this.currentPath.parentNode||this.svg.appendChild(this.currentPath),this.updateCurrentPathBounds(t,s),this.updateBounds(this.currentPathBounds.minX-i*.5,this.currentPathBounds.minY-i*.5,this.currentPathBounds.maxX-this.currentPathBounds.minX+i,this.currentPathBounds.maxY-this.currentPathBounds.minY+i),this}updateCurrentPathBounds(t,s){this.currentPathBounds.minX=Math.min(this.currentPathBounds.minX,t),this.currentPathBounds.minY=Math.min(this.currentPathBounds.minY,s),this.currentPathBounds.maxX=Math.max(this.currentPathBounds.maxX,t),this.currentPathBounds.maxY=Math.max(this.currentPathBounds.maxY,s)}updateBounds(t,s,i,e){this.bounds.minX=Math.min(this.bounds.minX,t),this.bounds.minY=Math.min(this.bounds.minY,s),this.bounds.maxX=Math.max(this.bounds.maxX,t+i),this.bounds.maxY=Math.max(this.bounds.maxY,s+e),this.svg.style.left=`${this.bounds.minX}px`,this.svg.style.top=`${this.bounds.minY}px`,this.svg.style.width=`${this.bounds.maxX-this.bounds.minX}px`,this.svg.style.height=`${this.bounds.maxY-this.bounds.minY}px`,this.updateViewBox()}updateViewBox(){if(this.bounds.minX<1/0){const t=this.bounds.maxX-this.bounds.minX,s=this.bounds.maxY-this.bounds.minY;this.svg.setAttribute("viewBox",`${this.bounds.minX} ${this.bounds.minY} ${t} ${s}`)}}closePath(){return this.currentPath&&(this.currentPath.setAttribute("d",`${this.currentPathStr} Z`),this.currentPath.setAttribute("fill",this.currentFill??"none"),this.currentStroke&&(this.currentPath.setAttribute("stroke",this.currentStroke.color),this.currentPath.setAttribute("stroke-width",this.currentStroke.width.toString())),this.svg.appendChild(this.currentPath),this.currentPath=null),this}endFill(){return this.currentFill=null,this}clear(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);return this.currentFill=null,this.currentPath=null,this.currentPathStr="",this.currentStroke=null,this.resetBounds(),this}on(t,s,i){this.svg.addEventListener(t,s,i)}}class Z{constructor(t,s){return this.onEnterFrame=s?t.bind(s):t,this.oldTime=Date.now(),this}start(){this.oldTime=Date.now(),this.onRequestAnimationFrame()}stop(){cancelAnimationFrame(this.requestAnimationFrameId)}onRequestAnimationFrame(){const t=Date.now()-this.oldTime;this.requestAnimationFrameId=requestAnimationFrame(this.onRequestAnimationFrame.bind(this)),this.oldTime+=t,this.onEnterFrame(t/1e3)}}class B{constructor(t=0,s=0,i){return this.parent=i,this.transform={local:{x:0,y:0,rotation:0},global:{x:0,y:0,rotation:0}},this.children=[],this.transform.local.x=t,this.transform.local.y=s,i&&i.children.push(this),this}setRotation(t){this.transform.local.rotation=f(t)}updateGlobalTransform(){const t=this.transform.local,s=this.transform.global;if(this.parent){const i=this.parent.transform.global,e=Math.sin(i.rotation),r=Math.cos(i.rotation),a=t.x*r-t.y*e,c=t.x*e+t.y*r;s.x=a+i.x,s.y=c+i.y,s.rotation=t.rotation+i.rotation}else s.x=t.x,s.y=t.y,s.rotation=t.rotation}}class J extends w{constructor(t){super(),this.fishId=t,this.gotoPos=[0,0],this.currentPos=[0,0],this.currentRotation=0,this.tailSwingSpineRootBoneRotation=0,this.spineBones=[],this.skinBones=[],this.currentSpineBlend=0,this.gotoSpineBlend=0,this.onResize=()=>{d.publish("onFishPoke",this.fishId)},this.onOver=()=>{d.publish("onFishPoke",this.fishId)},this.graphics=new E,this.addChild(this.graphics);const{fishStateModel:s,fishNavigationModel:i}=g.getModel(t);this.fishStateModel=s,this.fishStateModel.fishStateChangeSignal.add(this.onStateChange,this),this.fishNavigationModel=i,this.currentPos=i.getCurrentPosition(),this.currentRotation=i.getCurrentRotation(),this.moveDecay=h.getMoveDecay(),this.graphics.on("pointerover",this.onOver),window.addEventListener("resize",this.onResize),this.setRandomTailSpeed(),this.createBones();const e=h.totalSpineBones;this.tailSwingSpineRotations=new Array(e).fill(0);const r=h.spineTurnPoseBonesAngle;this.rightTurnSpineRotations=new Array(e).fill(-r),this.leftTurnSpineRotations=new Array(e).fill(r),this.spineBlendRotations=this.rightTurnSpineRotations,this.timer=new Z(this.onEnterFrame,this),this.timer.start(),i.onTurnDirectionChangeSignal.add(this.onTurnDirectionChange,this)}onEnterFrame(t){this.gotoPos=this.fishNavigationModel.getCurrentPosition(),this.currentPos=z(this.currentPos,this.gotoPos,this.moveDecay,t),M(this.currentPos,this.gotoPos)>.1&&(this.currentRotation=Math.PI*.5-O(this.currentPos,this.gotoPos)),this.currentTailSpeed=b(this.currentTailSpeed,this.gotoTailSpeed,h.tailSpeedDecay,t),this.currentSpineBlend=b(this.currentSpineBlend,this.gotoSpineBlend,h.spineBlendDecay,t),this.updateTailSwingAnimation(),this.updateSpineBones(this.tailSwingSpineRotations,this.spineBlendRotations,this.currentSpineBlend),this.graphics.clear(),this.graphics.beginFill(h.getFishColor(this.fishId)),this.graphics.moveTo(this.skinBones[0].transform.global.x,this.skinBones[0].transform.global.y);for(let r=1;r<this.skinBones.length;r++)this.graphics.lineTo(this.skinBones[r].transform.global.x,this.skinBones[r].transform.global.y);const[i,e]=this.currentPos;this.graphics.x=i,this.graphics.y=e,this.graphics.rotation=X(this.currentRotation)+270}updateTailSwingAnimation(){this.tailSwingSpineRootBoneRotation=(this.tailSwingSpineRootBoneRotation+this.currentTailSpeed)%360;for(let t=0;t<h.totalSpineBones;t++)this.tailSwingSpineRotations[t]=Math.sin(f(this.tailSwingSpineRootBoneRotation-t*h.tailSwingFollowOffset))*h.tailSwingMaxBend}updateSpineBones(t,s,i){for(let e=0;e<h.totalSpineBones;e++){const r=this.spineBones[e];r.setRotation(F(t[e],s[e],i)),r.updateGlobalTransform(),r.children.forEach(a=>{a.updateGlobalTransform()})}}onTurnDirectionChange(t){if(t===0){this.gotoSpineBlend=0;return}this.spineBlendRotations=t===1?this.rightTurnSpineRotations:this.leftTurnSpineRotations,this.gotoSpineBlend=1}onStateChange(t){this.fishStateModel.inAState("rotationState")&&(this.moveDecay=h.getMoveDecay()),this.fishStateModel.inAState("moveForwardState")&&this.setRandomTailSpeed()}setRandomTailSpeed(){const{startSpeed:t,endSpeed:s}=h.getRandomTailSpeed(this.fishNavigationModel.isRush());this.currentTailSpeed=t,this.gotoTailSpeed=s}createBones(){let t=0;const s=h.totalSpineBones;for(let i=0;i<=s;i++){const e=h.getSpineBoneScale(i),r=e-t;t=e;const a=(1-e)*h.fishWidth*.5,c=r*h.fishHeight,u=new B(0,-c,this.spineBones[i-1]);i<s?(this.skinBones.push(new B(a,0,u)),this.skinBones.unshift(new B(-a,0,u))):this.skinBones.unshift(u),this.spineBones.push(u)}}}class _ extends w{constructor(){super(),this.graphics=new E,this.graphics.beginFill(16777215),this.graphics.drawPathFromString("M-0 27.95l0 -4.31 6 0 0 3.28c0,0.83 0.55,1.52 1.42,2.03 1.1,0.65 2.66,1 4.32,1 1.76,0 3.26,-0.41 4.27,-1.19 0.89,-0.69 1.42,-1.7 1.42,-3.01 0,-3.03 -3.18,-4.26 -6.68,-5.62l-0.71 -0.28c-2.24,-0.84 -4.51,-1.75 -6.27,-3.24 -1.83,-1.55 -3.06,-3.68 -3.06,-6.9 0,-3.17 1.2,-5.5 3.1,-7.1 2.14,-1.8 5.15,-2.62 8.31,-2.62 2.78,0 5.6,0.57 7.65,1.69 1.94,1.06 3.2,2.6 3.2,4.63l0 4.73 -6.04 0 0 -3.14c0,-0.52 -0.45,-0.97 -1.12,-1.32 -0.98,-0.51 -2.36,-0.77 -3.69,-0.77 -1.51,0 -2.83,0.35 -3.73,1.05 -0.76,0.59 -1.22,1.47 -1.22,2.63 0,2.83 2.9,3.93 6.19,5.18l0.27 0.1c2.5,0.94 4.98,1.89 6.89,3.43 2,1.61 3.33,3.82 3.33,7.18 0,3.27 -1.28,5.81 -3.35,7.57 -2.23,1.9 -5.36,2.86 -8.76,2.86 -2.94,0 -6.08,-0.72 -8.35,-2.18 -2.03,-1.31 -3.39,-3.19 -3.39,-5.67zm28.49 5.61c-1.46,-1.33 -2.41,-3.24 -2.41,-5.75 0,-4.18 2.72,-6.39 5.98,-7.56 3.08,-1.1 6.63,-1.24 8.65,-1.24l0.65 0 0 -0.04c0,-1.51 -0.38,-2.53 -1.02,-3.17 -0.73,-0.73 -1.85,-1.03 -3.17,-1.03 -3.46,0 -6.26,2.11 -6.27,2.12l-0.77 0.58 -2.65 -4.69 0.56 -0.45c0.01,-0.01 3.69,-2.99 9.5,-2.99 3.25,0 5.75,0.87 7.46,2.56 1.71,1.7 2.59,4.17 2.59,7.4l0 10.56c0,0.11 0,0.16 0.01,0.17 0.01,0.01 0.07,0.01 0.17,0.01l3.23 0 0 5.2 -5.57 0c-1.22,0 -2.13,-0.31 -2.75,-0.86 -0.5,-0.44 -0.81,-1 -0.95,-1.65 -1.33,1.48 -3.56,3.07 -6.95,3.07 -2.31,0 -4.63,-0.73 -6.29,-2.25zm7.23 -9.32c-1.79,0.5 -3.36,1.43 -3.36,3.2 0,0.87 0.33,1.7 0.95,2.29 0.57,0.54 1.4,0.88 2.45,0.88 1.59,0 2.91,-0.77 3.86,-1.89 1.15,-1.35 1.78,-3.21 1.78,-4.92l0 -0.13 -0.32 0c-1.04,0 -3.36,0.02 -5.37,0.58z"),this.graphics.x=30,this.graphics.y=30,this.graphics.alpha=.8,this.addChild(this.graphics)}}const C=new w;document.getElementById("app").appendChild(C.getRootDiv());for(let n=h.totalFishCount-1;n>=0;n--)g.initFish(n),C.addChild(new J(n)),new K(n).setState("moveForwardState");C.addChild(new _);
