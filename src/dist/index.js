(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();class v{constructor(){this.containerDivParams={x:0,y:0,visible:!0,alpha:1,scale:1,rotation:0},this.rootDiv=document.createElement("div"),this.rootDiv.style.position="absolute"}addChild(t){this.rootDiv.appendChild(t.getRootDiv())}getRootDiv(){return this.rootDiv}set x(t){this.containerDivParams.x=t,this.updateStyle()}get x(){return this.containerDivParams.x}set y(t){this.containerDivParams.y=t,this.updateStyle()}get y(){return this.containerDivParams.y}set scale(t){this.containerDivParams.scale=t,this.updateStyle()}get scale(){return this.containerDivParams.scale}set rotation(t){this.containerDivParams.rotation=t,this.updateStyle()}set alpha(t){this.containerDivParams.alpha=t,this.updateStyle()}get alpha(){return this.containerDivParams.alpha}set visible(t){this.containerDivParams.visible=t,this.updateStyle()}get visible(){return this.containerDivParams.visible}updateStyle(){this.rootDiv.style.left=`${this.containerDivParams.x}px`,this.rootDiv.style.top=`${this.containerDivParams.y}px`,this.rootDiv.style.visibility=this.containerDivParams.visible?"visible":"hidden",this.rootDiv.style.opacity=this.containerDivParams.alpha.toString(),this.rootDiv.style.transform=`scale(${this.containerDivParams.scale}) rotate(${this.containerDivParams.rotation}deg)`}}class y{constructor(){this.slots=new Map,this.once=new Map}add(t,s){this.addSlot(this.slots,t,s||this)}addOnce(t,s){this.addSlot(this.once,t,s||this)}addSlot(t,s,e=this){var i;t.has(e)||t.set(e,new Set),(i=t.get(e))==null||i.add(s)}remove(t,s){this.removeSlot(this.slots,t,s||this),this.removeSlot(this.once,t,s||this)}removeSlot(t,s,e=this){const i=t.get(e);i&&(i.delete(s),i.size===0&&t.delete(e))}removeAll(){this.slots.clear(),this.once.clear()}dispatch(t){this.slots.forEach((s,e)=>{s.forEach(i=>{i.call(e,t)})}),this.once.forEach((s,e)=>{s.forEach(i=>{i.call(e,t)})}),this.once.clear()}isEmpty(){return this.slots.size===0&&this.once.size===0}}const B=n=>n*Math.PI/180,Q=n=>n*180/Math.PI,F=(n,t,s)=>n+(t-n)*s,V=(n,t,s)=>[F(n[0],t[0],s),F(n[1],t[1],s)],T=(n,t=1)=>`rgba(${n>>16&255}, ${n>>8&255}, ${n&255}, ${t})`,q=(n,t)=>[n[0]+t[0],n[1]+t[1]],z=(n,t)=>[n[0]*t,n[1]*t],W=n=>[-n[1],n[0]];function U(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function H(n){const t=U(n);if(t===0)throw new Error("Cannot compute the unit vector of a zero vector.");return[n[0]/t,n[1]/t]}const G=(n,t,s,e)=>[D(n[0],t[0],s,e),D(n[1],t[1],s,e)],D=(n,t,s,e)=>t+(n-t)*Math.exp(-s*e),j=(n,t,s)=>{const e=Math.cos(s),i=Math.sin(s),o=n[0]-t[0],r=n[1]-t[1];return[o*e-r*i+t[0],o*i+r*e+t[1]]},A=(n,t)=>{const s=t[0]-n[0],e=t[1]-n[1];return Math.sqrt(s*s+e*e)},L=(n,t)=>{const s=t[0]-n[0],e=t[1]-n[1];return Math.atan2(s,e)};class K{constructor(){this.rush=!1,this.currentPos=[0,0],this.fishBoundsRadius=120,this.turnDirection=0,this.onTurnDirectionChangeSignal=new y,this.setRandomSpeed(),this.setCurrentRotation(B(Math.random()*360)),this.setCurrentPosition(-120-Math.random()*120,-120-Math.random()*120)}setCurrentPosition(t,s){this.currentPos[0]=t,this.currentPos[1]=s}setCurrentRotation(t){this.currentRotation=t,this.currentMoveDirection=H([Math.cos(this.currentRotation),Math.sin(this.currentRotation)])}getCurrentRotation(){return this.currentRotation}setTurnDirection(t){this.turnDirection!==t&&(this.turnDirection=t,this.onTurnDirectionChangeSignal.dispatch(this.turnDirection))}getTurnDirection(){return this.turnDirection}getCurrentMoveDirection(){return[...this.currentMoveDirection]}getCurrentPosition(){return[...this.currentPos]}getRandomRotationAngle(){const t=Math.random()*90+30;let s=Math.random()*190;Math.random()>.3&&(s*=.6);const e=W(this.currentMoveDirection),i=Math.floor(Math.random()*2)*2-1;return e[0]*=i,e[1]*=i,{center:q(this.currentPos,z(e,t)),angle:s*i,radius:t}}getRandomForwardPoint(){const t=this.rush?1.6+Math.random()*1.6:1,s=(Math.random()*150+150)*t;return q(this.currentPos,z(this.currentMoveDirection,s))}getRandomPointOnScreen(){const t=window.innerWidth,s=window.innerHeight;return[Math.random()*t,Math.random()*s]}getClosestRandomPointOnScreen(){let t=this.getRandomPointOnScreen(),s=A(this.currentPos,t);for(let e=0;e<5;e++){const i=this.getRandomPointOnScreen(),o=A(this.currentPos,i);o<s&&(t=[...i],s=o)}return t}setRandomSpeed(){const t=this.rush?3.2+Math.random()*1.6:1;this.currentSpeed=(300+Math.random()*300)*t}setRush(t){this.rush=t}setRandomRush(){this.rush=Math.random()<.2}isRush(){return this.rush}getMoveDuration(t){return t/this.currentSpeed*1e3}isFishOutsideScreenBounds(){const t=window.innerWidth,s=window.innerHeight,[e,i]=this.currentPos;return e+this.fishBoundsRadius<0||e-this.fishBoundsRadius>t||i+this.fishBoundsRadius<0||i-this.fishBoundsRadius>s}getRandomIdleDelay(){return Math.random()*2e3+100}}class Z{constructor(){this.symbols={},this.fishStateChangeSignal=new y,this.currentFishState=null}setFishState(t){this.symbols[t]===void 0&&(this.symbols[t]=Symbol(t)),this.currentFishState=this.symbols[t],this.fishStateChangeSignal.dispatch(t)}inAState(...t){for(let s=0;s<t.length;s++){const e=t[s];if(this.symbols[e]===void 0&&(this.symbols[e]=Symbol(e)),this.currentFishState===this.symbols[e])return!0}return!1}}const P=new class{constructor(){this.models=[]}initFish(n){this.models[n]={},this.models[n].fishStateModel=new Z,this.models[n].fishNavigationModel=new K}getModel(n){return this.models[n]}},u=class u{constructor(t,s,e=b.Linear){this.resolve=null,this.isReverse=!1,this.duration=t,this.ease=e,this.onUpdate=s}static add(t){this.tweens.size===0&&(this.requestAnimationFrameId=requestAnimationFrame(this.onEnterFrame)),this.tweens.add(t)}static remove(t){this.tweens.delete(t),this.tweens.size===0&&cancelAnimationFrame(this.requestAnimationFrameId)}static now(){return performance.now()}params(t){return u.remove(this),Object.assign(this,t),this}start(){return this.isReverse=!1,new Promise((t,s)=>{this.resolve=t,this.startTime=u.now(),u.add(this)})}reverse(){return this.isReverse=!0,new Promise((t,s)=>{this.resolve=t,this.startTime=u.now(),u.add(this)})}tick(t){let s=(t-this.startTime)/this.duration;if(s>1&&(s=1),this.onUpdate){const e=this.ease(this.isReverse?1-s:s);this.onUpdate(e)}s>=1&&this.stop()}endInstantly(){this.onUpdate(this.isReverse?0:1),this.stop()}stop(){u.remove(this),this.resolve&&(this.resolve(this),this.resolve=null)}kill(){u.remove(this),this.onUpdate=null,this.ease=null,this.resolve=null}};u.tweens=new Set,u.onEnterFrame=()=>{const t=u.now();u.tweens.forEach(s=>{s.tick(t)}),u.requestAnimationFrameId=requestAnimationFrame(u.onEnterFrame)};let x=u;const X=class X{static getTween(t,s,e=b.Linear){let i;return this.pool.length?(i=this.pool.pop(),i.params({duration:t,onUpdate:s,ease:e})):i=new x(t,s,e),i}static returnTween(t){t.kill(),this.pool.unshift(t)}};X.pool=[];let f=X;const a=class a{};a.Linear=t=>t,a.QuadEaseIn=t=>t*t,a.QuadEaseOut=t=>t*(2-t),a.QuadEaseInOut=t=>(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1),a.CubicEaseIn=t=>t*t*t,a.CubicEaseOut=t=>--t*t*t+1,a.CubicEaseInOut=t=>(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2),a.QuarticEaseIn=t=>t*t*t*t,a.QuarticEaseOut=t=>1- --t*t*t*t,a.QuarticEaseInOut=t=>(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),a.QuinticEaseIn=t=>t*t*t*t*t,a.QuinticEaseOut=t=>--t*t*t*t*t+1,a.QuinticEaseInOut=t=>(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),a.SinEaseIn=t=>1-Math.cos(t*Math.PI/2),a.SinEaseOut=t=>Math.sin(t*Math.PI/2),a.SinEaseInOut=t=>.5*(1-Math.cos(Math.PI*t)),a.CircEaseIn=t=>1-Math.sqrt(1-t*t),a.CircEaseOut=t=>Math.sqrt(1- --t*t),a.CircEaseInOut=t=>(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),a.ElasticEaseIn=t=>t===0?0:t===1?1:-Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI),a.ElasticEaseOut=t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t-.1)*5*Math.PI)+1,a.ElasticEaseInOut=t=>t===0?0:t===1?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin((t-1.1)*5*Math.PI)+1),a.BackEaseIn=t=>t*t*((1.70158+1)*t-1.70158),a.BackEaseOut=t=>--t*t*((1.70158+1)*t+1.70158)+1,a.BackEaseInOut=t=>{const s=2.5949095;return(t*=2)<1?.5*(t*t*((s+1)*t-s)):.5*((t-=2)*t*((s+1)*t+s)+2)},a.BounceEaseIn=t=>1-a.BounceEaseOut(1-t),a.BounceEaseOut=t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,a.BounceEaseInOut=t=>t<.5?a.BounceEaseIn(t*2)*.5:a.BounceEaseOut(t*2-1)*.5+.5;let b=a;const l=new class{constructor(){this.totalSpineBones=5,this.tailSwingMaxBend=6,this.tailSwingFollowOffset=50,this.tailSpeedDecay=2,this.spineBlendDecay=5,this.spineTurnPoseBonesAngle=13,this.fishWidth=40,this.fishHeight=120,this.totalFishCount=10,this.totalColorfulFishCount=3,this.fishColors=[10092288,52479,16737792,16750899,16751052,16711680],this.defaultFishColor=11184810,this.takenFishColors=[]}getSpineBoneScale(n){return b.QuadEaseOut(n/this.totalSpineBones)}getRandomTailSpeed(n){const t=1+Math.random()*.3;return{startSpeed:(n?20:10)*t,endSpeed:2*t}}getMoveDecay(){return 1+Math.random()*2}getFishColor(n){if(n<this.totalColorfulFishCount){if(this.takenFishColors[n]===void 0){const t=Math.floor(Math.random()*this.fishColors.length);this.takenFishColors[n]=this.fishColors.splice(t,1)[0]}return this.takenFishColors[n]}return this.defaultFishColor}};class J{constructor(){this.currentState=null,this.idsArr={},this.statesArr={},this.stateChangeSignal=new y}addState(t,s){if(this.idsArr[s])throw new Error(`State already defined: ${s}`);this.idsArr[s]=Object.keys(this.idsArr).length,this.statesArr[s]=new t(this,s)}setState(t){this.currentState&&this.currentState.cleanUp(),this.currentState=this.statesArr[t],this.stateChangeSignal.dispatch(this.currentState.id),this.currentState.execute()}}const Y=class Y{static publish(t,s){var e;(e=this.signals[t])==null||e.dispatch(s)}static subscribe(t,s,e){let i=this.signals[t];return i||(i=new y,this.signals[t]=i),i.add(s,e),{unsubscribe:()=>{i==null||i.remove(s,e),this.cleanupSignal(t)}}}static subscribeOnce(t,s,e){let i=this.signals[t];return i||(i=new y,this.signals[t]=i),i.addOnce(s,e),{unsubscribe:()=>{i==null||i.remove(s,e),this.cleanupSignal(t)}}}static cleanupSignal(t){const s=this.signals[t];s&&s.isEmpty()&&delete this.signals[t]}};Y.signals={};let S=Y;class E{constructor(t,s){this.stateMachine=t,this.id=s}execute(){}cleanUp(){}}class _ extends E{execute(){const{fishNavigationModel:t}=P.getModel(this.stateMachine.getFishId());t.setTurnDirection(0),this.idleTimeout=setTimeout(()=>{t.setRandomRush(),t.setRandomSpeed(),this.stateMachine.setState("rotationState")},t.getRandomIdleDelay()),this.onFishPokeSubscribe=S.subscribe("onFishPoke",s=>{s===this.stateMachine.getFishId()&&(clearTimeout(this.idleTimeout),t.setRush(!0),t.setRandomSpeed(),this.stateMachine.setState("rotationState"))})}cleanUp(){this.onFishPokeSubscribe.unsubscribe()}}class tt extends E{execute(){const{fishNavigationModel:t}=P.getModel(this.stateMachine.getFishId());t.setTurnDirection(0);const s=t.getCurrentPosition();let e,i=!1;if(t.isFishOutsideScreenBounds()){e=t.getClosestRandomPointOnScreen();const c=Math.PI*.5-L(s,e);t.setCurrentRotation(c)}else e=t.getRandomForwardPoint();const o=A(s,e),r=t.getMoveDuration(o),h=f.getTween(r,c=>{const p=V(s,e,c);t.setCurrentPosition(...p)});h.start().then(()=>{f.returnTween(h),this.stateMachine.setState(i?"rotationState":"idleState")}),this.onFishPokeSubscribe=S.subscribe("onFishPoke",c=>{c===this.stateMachine.getFishId()&&!t.isRush()&&(i=!0,t.setRush(!0),t.setRandomSpeed(),h.stop())})}cleanUp(){this.onFishPokeSubscribe.unsubscribe()}}class st extends E{execute(){const{fishNavigationModel:t}=P.getModel(this.stateMachine.getFishId());if(t.isFishOutsideScreenBounds()){this.stateMachine.setState("moveForwardState");return}const{center:s,angle:e,radius:i}=t.getRandomRotationAngle();t.setTurnDirection(e<0?-1:1);const o=t.getCurrentPosition(),r=t.getCurrentRotation(),h=Math.abs(i*B(e)),c=t.getMoveDuration(h),p=f.getTween(c,w=>{const R=B(w*e),k=j(o,s,R);t.setCurrentPosition(...k),t.setCurrentRotation(r+R)});p.start().then(()=>{f.returnTween(p),this.stateMachine.setState("moveForwardState")}),this.onFishPokeSubscribe=S.subscribe("onFishPoke",w=>{w===this.stateMachine.getFishId()&&!t.isRush()&&(t.setRush(!0),t.setRandomSpeed(),p.stop())})}cleanUp(){this.onFishPokeSubscribe.unsubscribe()}}class et extends J{constructor(t){super(),this.fishId=t,this.addState(_,"idleState"),this.addState(st,"rotationState"),this.addState(tt,"moveForwardState");const{fishStateModel:s}=P.getModel(t);this.stateChangeSignal.add(e=>{s.setFishState(e)})}getFishId(){return this.fishId}}class O extends v{constructor(){super(),this.svgNS="http://www.w3.org/2000/svg",this.currentFill=null,this.currentStroke=null,this.currentPath=null,this.currentPathStr="",this.svg=document.createElementNS(this.svgNS,"svg"),this.svg.style.position="absolute",this.rootDiv.appendChild(this.svg),this.resetBounds()}resetBounds(){this.bounds={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},this.currentPathBounds={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}beginFill(t,s=1){return this.currentFill=T(t,s),this}lineStyle(t,s,e=1){return this.currentStroke={width:t,color:T(s,e)},this}drawRect(t,s,e,i,o){var c;const r=document.createElementNS(this.svgNS,"rect");r.setAttribute("x",t.toString()),r.setAttribute("y",s.toString()),r.setAttribute("width",e.toString()),r.setAttribute("height",i.toString()),o&&(r.setAttribute("rx",o.toString()),r.setAttribute("ry",o.toString())),r.setAttribute("fill",this.currentFill??"none");const h=((c=this.currentStroke)==null?void 0:c.width)??0;return this.currentStroke&&(r.setAttribute("stroke",this.currentStroke.color),r.setAttribute("stroke-width",h.toString())),this.svg.appendChild(r),this.updateBounds(t-h*.5,s-h*.5,e+h,i+h),this}drawCircle(t,s,e){var r;const i=document.createElementNS(this.svgNS,"circle");i.setAttribute("cx",t.toString()),i.setAttribute("cy",s.toString()),i.setAttribute("r",e.toString()),i.setAttribute("fill",this.currentFill??"none");const o=((r=this.currentStroke)==null?void 0:r.width)??0;return this.currentStroke&&(i.setAttribute("stroke",this.currentStroke.color),i.setAttribute("stroke-width",o.toString())),this.svg.appendChild(i),this.updateBounds(t-e-o*.5,s-e-o*.5,e*2+o,e*2+o),this}drawPathFromString(t,s){var o;const e=document.createElementNS(this.svgNS,"path");e.setAttribute("d",t),e.setAttribute("fill",this.currentFill??"none");const i=((o=this.currentStroke)==null?void 0:o.width)??0;return this.currentStroke&&(e.setAttribute("stroke",this.currentStroke.color),e.setAttribute("stroke-width",this.currentStroke.width.toString())),this.svg.appendChild(e),this.updateBounds(s.x-i*.5,s.y-i*.5,s.w+i,s.h+i),this}moveTo(t,s){return this.currentPath=document.createElementNS(this.svgNS,"path"),this.currentPathStr=`M ${t} ${s}`,this.updateCurrentPathBounds(t,s),this}lineTo(t,s){var i;if(!this.currentPath)return console.error("No path has been started. Call moveTo() before calling lineTo()."),this;this.currentPathStr+=` L ${t} ${s}`,this.currentPath.setAttribute("d",this.currentPathStr),this.currentPath.setAttribute("fill",this.currentFill??"none");const e=((i=this.currentStroke)==null?void 0:i.width)??0;return this.currentStroke&&(this.currentPath.setAttribute("stroke",this.currentStroke.color),this.currentPath.setAttribute("stroke-width",e.toString())),this.currentPath.parentNode||this.svg.appendChild(this.currentPath),this.updateCurrentPathBounds(t,s),this.updateBounds(this.currentPathBounds.minX-e*.5,this.currentPathBounds.minY-e*.5,this.currentPathBounds.maxX-this.currentPathBounds.minX+e,this.currentPathBounds.maxY-this.currentPathBounds.minY+e),this}updateCurrentPathBounds(t,s){this.currentPathBounds.minX=Math.min(this.currentPathBounds.minX,t),this.currentPathBounds.minY=Math.min(this.currentPathBounds.minY,s),this.currentPathBounds.maxX=Math.max(this.currentPathBounds.maxX,t),this.currentPathBounds.maxY=Math.max(this.currentPathBounds.maxY,s)}updateBounds(t,s,e,i){this.bounds.minX=Math.min(this.bounds.minX,t),this.bounds.minY=Math.min(this.bounds.minY,s),this.bounds.maxX=Math.max(this.bounds.maxX,t+e),this.bounds.maxY=Math.max(this.bounds.maxY,s+i),this.svg.style.left=`${this.bounds.minX}px`,this.svg.style.top=`${this.bounds.minY}px`,this.svg.style.width=`${this.bounds.maxX-this.bounds.minX}px`,this.svg.style.height=`${this.bounds.maxY-this.bounds.minY}px`,this.updateViewBox()}updateViewBox(){if(this.bounds.minX<1/0){const t=this.bounds.maxX-this.bounds.minX,s=this.bounds.maxY-this.bounds.minY;this.svg.setAttribute("viewBox",`${this.bounds.minX} ${this.bounds.minY} ${t} ${s}`)}}closePath(){return this.currentPath&&(this.currentPath.setAttribute("d",`${this.currentPathStr} Z`),this.currentPath.setAttribute("fill",this.currentFill??"none"),this.currentStroke&&(this.currentPath.setAttribute("stroke",this.currentStroke.color),this.currentPath.setAttribute("stroke-width",this.currentStroke.width.toString())),this.svg.appendChild(this.currentPath),this.currentPath=null),this}endFill(){return this.currentFill=null,this}clear(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);return this.currentFill=null,this.currentPath=null,this.currentPathStr="",this.currentStroke=null,this.resetBounds(),this}on(t,s,e){this.svg.addEventListener(t,s,e)}}class it{constructor(t,s){return this.onEnterFrame=s?t.bind(s):t,this.oldTime=Date.now(),this}start(){this.oldTime=Date.now(),this.onRequestAnimationFrame()}stop(){cancelAnimationFrame(this.requestAnimationFrameId)}onRequestAnimationFrame(){const t=Date.now()-this.oldTime;this.requestAnimationFrameId=requestAnimationFrame(this.onRequestAnimationFrame.bind(this)),this.oldTime+=t,this.onEnterFrame(t/1e3)}}class I{constructor(t=0,s=0,e){return this.parent=e,this.transform={local:{x:0,y:0,rotation:0},global:{x:0,y:0,rotation:0}},this.children=[],this.transform.local.x=t,this.transform.local.y=s,e&&e.children.push(this),this}setRotation(t){this.transform.local.rotation=B(t)}updateGlobalTransform(){const t=this.transform.local,s=this.transform.global;if(this.parent){const e=this.parent.transform.global,i=Math.sin(e.rotation),o=Math.cos(e.rotation),r=t.x*o-t.y*i,h=t.x*i+t.y*o;s.x=r+e.x,s.y=h+e.y,s.rotation=t.rotation+e.rotation}else s.x=t.x,s.y=t.y,s.rotation=t.rotation}}class nt extends v{constructor(t){super(),this.fishId=t,this.gotoPos=[0,0],this.currentPos=[0,0],this.currentRotation=0,this.tailSwingSpineRootBoneRotation=0,this.spineBones=[],this.skinBones=[],this.currentSpineBlend=0,this.gotoSpineBlend=0,this.onResize=()=>{S.publish("onFishPoke",this.fishId)},this.onOver=()=>{S.publish("onFishPoke",this.fishId)},this.graphics=new O,this.addChild(this.graphics);const{fishStateModel:s,fishNavigationModel:e}=P.getModel(t);this.fishStateModel=s,this.fishStateModel.fishStateChangeSignal.add(this.onStateChange,this),this.fishNavigationModel=e,this.currentPos=e.getCurrentPosition(),this.currentRotation=e.getCurrentRotation(),this.moveDecay=l.getMoveDecay(),this.graphics.on("pointerover",this.onOver),window.addEventListener("resize",this.onResize),this.setRandomTailSpeed(),this.createBones();const i=l.totalSpineBones;this.tailSwingSpineRotations=new Array(i).fill(0);const o=l.spineTurnPoseBonesAngle;this.rightTurnSpineRotations=new Array(i).fill(-o),this.leftTurnSpineRotations=new Array(i).fill(o),this.spineBlendRotations=this.rightTurnSpineRotations,this.timer=new it(this.onEnterFrame,this),this.timer.start(),e.onTurnDirectionChangeSignal.add(this.onTurnDirectionChange,this)}onEnterFrame(t){this.gotoPos=this.fishNavigationModel.getCurrentPosition(),this.currentPos=G(this.currentPos,this.gotoPos,this.moveDecay,t),A(this.currentPos,this.gotoPos)>.1&&(this.currentRotation=Math.PI*.5-L(this.currentPos,this.gotoPos)),this.currentTailSpeed=D(this.currentTailSpeed,this.gotoTailSpeed,l.tailSpeedDecay,t),this.currentSpineBlend=D(this.currentSpineBlend,this.gotoSpineBlend,l.spineBlendDecay,t),this.updateTailSwingAnimation(),this.updateSpineBones(this.tailSwingSpineRotations,this.spineBlendRotations,this.currentSpineBlend),this.drawSkin()}drawSkin(){this.graphics.clear(),this.graphics.beginFill(l.getFishColor(this.fishId)),this.graphics.moveTo(this.skinBones[0].transform.global.x,this.skinBones[0].transform.global.y);for(let e=1;e<this.skinBones.length;e++)this.graphics.lineTo(this.skinBones[e].transform.global.x,this.skinBones[e].transform.global.y);const[t,s]=this.currentPos;this.graphics.x=t,this.graphics.y=s,this.graphics.rotation=Q(this.currentRotation)+270}updateTailSwingAnimation(){this.tailSwingSpineRootBoneRotation=(this.tailSwingSpineRootBoneRotation+this.currentTailSpeed)%360;for(let t=0;t<l.totalSpineBones;t++)this.tailSwingSpineRotations[t]=Math.sin(B(this.tailSwingSpineRootBoneRotation-t*l.tailSwingFollowOffset))*l.tailSwingMaxBend}updateSpineBones(t,s,e){for(let i=0;i<l.totalSpineBones;i++){const o=this.spineBones[i];o.setRotation(F(t[i],s[i],e)),o.updateGlobalTransform(),o.children.forEach(r=>{r.updateGlobalTransform()})}}onTurnDirectionChange(t){if(t===0){this.gotoSpineBlend=0;return}this.spineBlendRotations=t===1?this.rightTurnSpineRotations:this.leftTurnSpineRotations,this.gotoSpineBlend=1}onStateChange(t){this.fishStateModel.inAState("rotationState")&&(this.moveDecay=l.getMoveDecay()),this.fishStateModel.inAState("moveForwardState")&&this.setRandomTailSpeed()}setRandomTailSpeed(){const{startSpeed:t,endSpeed:s}=l.getRandomTailSpeed(this.fishNavigationModel.isRush());this.currentTailSpeed=t,this.gotoTailSpeed=s}createBones(){let t=0;const s=l.totalSpineBones;for(let e=0;e<=s;e++){const i=l.getSpineBoneScale(e),o=i-t;t=i;const r=(1-i)*l.fishWidth*.5,h=o*l.fishHeight,c=new I(0,-h,this.spineBones[e-1]);e<s?(this.skinBones.push(new I(r,0,c)),this.skinBones.unshift(new I(-r,0,c))):this.skinBones.unshift(c),this.spineBones.push(c)}}}class ot extends v{constructor(){super();const t={x:30,y:30},s=16777215,e=.8,i=e*.8,o={x:0,y:0,w:51,h:36},r="github.com/salazkin",h=6710886,c=10,p=.8,w=.6,R=300,k=b.SinEaseIn,g=new O;g.beginFill(s),g.drawPathFromString("M-0 27.95l0 -4.31 6 0 0 3.28c0,0.83 0.55,1.52 1.42,2.03 1.1,0.65 2.66,1 4.32,1 1.76,0 3.26,-0.41 4.27,-1.19 0.89,-0.69 1.42,-1.7 1.42,-3.01 0,-3.03 -3.18,-4.26 -6.68,-5.62l-0.71 -0.28c-2.24,-0.84 -4.51,-1.75 -6.27,-3.24 -1.83,-1.55 -3.06,-3.68 -3.06,-6.9 0,-3.17 1.2,-5.5 3.1,-7.1 2.14,-1.8 5.15,-2.62 8.31,-2.62 2.78,0 5.6,0.57 7.65,1.69 1.94,1.06 3.2,2.6 3.2,4.63l0 4.73 -6.04 0 0 -3.14c0,-0.52 -0.45,-0.97 -1.12,-1.32 -0.98,-0.51 -2.36,-0.77 -3.69,-0.77 -1.51,0 -2.83,0.35 -3.73,1.05 -0.76,0.59 -1.22,1.47 -1.22,2.63 0,2.83 2.9,3.93 6.19,5.18l0.27 0.1c2.5,0.94 4.98,1.89 6.89,3.43 2,1.61 3.33,3.82 3.33,7.18 0,3.27 -1.28,5.81 -3.35,7.57 -2.23,1.9 -5.36,2.86 -8.76,2.86 -2.94,0 -6.08,-0.72 -8.35,-2.18 -2.03,-1.31 -3.39,-3.19 -3.39,-5.67zm28.49 5.61c-1.46,-1.33 -2.41,-3.24 -2.41,-5.75 0,-4.18 2.72,-6.39 5.98,-7.56 3.08,-1.1 6.63,-1.24 8.65,-1.24l0.65 0 0 -0.04c0,-1.51 -0.38,-2.53 -1.02,-3.17 -0.73,-0.73 -1.85,-1.03 -3.17,-1.03 -3.46,0 -6.26,2.11 -6.27,2.12l-0.77 0.58 -2.65 -4.69 0.56 -0.45c0.01,-0.01 3.69,-2.99 9.5,-2.99 3.25,0 5.75,0.87 7.46,2.56 1.71,1.7 2.59,4.17 2.59,7.4l0 10.56c0,0.11 0,0.16 0.01,0.17 0.01,0.01 0.07,0.01 0.17,0.01l3.23 0 0 5.2 -5.57 0c-1.22,0 -2.13,-0.31 -2.75,-0.86 -0.5,-0.44 -0.81,-1 -0.95,-1.65 -1.33,1.48 -3.56,3.07 -6.95,3.07 -2.31,0 -4.63,-0.73 -6.29,-2.25zm7.23 -9.32c-1.79,0.5 -3.36,1.43 -3.36,3.2 0,0.87 0.33,1.7 0.95,2.29 0.57,0.54 1.4,0.88 2.45,0.88 1.59,0 2.91,-0.77 3.86,-1.89 1.15,-1.35 1.78,-3.21 1.78,-4.92l0 -0.13 -0.32 0c-1.04,0 -3.36,0.02 -5.37,0.58z",o),g.x=t.x,g.y=t.y,g.alpha=e,this.addChild(g);const d=new v;d.alpha=p,d.x=t.x,d.y=t.y+o.h+c,d.visible=!1;const M=d.getRootDiv();M.innerText=r,M.style.color=T(h),M.style.fontFamily="sans-serif",M.style.userSelect="none",M.style.pointerEvents="none",this.addChild(d);const m=new O;m.x=t.x,m.y=t.y,m.beginFill(16777215,0),m.drawRect(o.x,o.y,o.w,o.h),m.getRootDiv().style.cursor="pointer",this.addChild(m),m.on("pointerup",()=>{window.location.href="http://github.com/salazkin"});const C=new x(R,$=>{g.alpha=F(e,i,$),d.alpha=F(0,w,$),d.visible=!0},k);m.on("pointerover",()=>{d.visible=!0,C.stop(),C.start()}),m.on("pointerout",async()=>{C.stop(),await C.reverse(),d.visible=!1})}}const N=new v;document.getElementById("app").appendChild(N.getRootDiv());for(let n=l.totalFishCount-1;n>=0;n--)P.initFish(n),N.addChild(new nt(n)),new et(n).setState("moveForwardState");N.addChild(new ot);
